# å¿«é€Ÿå‚è€ƒ - ã€Œæ ‡è®°è¯»å®Œã€åŠŸèƒ½

## ğŸ¯ ä¸€å¥è¯æ€»ç»“
ç”¨æˆ·å¯ä»¥åœ¨ä¹¦ç±é¢„è§ˆå¡ç‰‡ä¸­ç‚¹å‡»ã€ŒMark as readã€æŒ‰é’®æ ‡è®°ä»»ä½•ä¹¦ç±ä¸ºå·²è¯»ï¼Œç³»ç»Ÿä¼šåœ¨ `user_book_progress` è¡¨ä¸­è®°å½•ç”¨æˆ·å’Œä¹¦ç±çš„é˜…è¯»çŠ¶æ€ï¼Œæ”¯æŒå¤šç”¨æˆ·ç‹¬ç«‹çš„å·²è¯»æ ‡è®°ã€‚

## ğŸ“Š æ ¸å¿ƒæ•°æ®è¡¨

```sql
CREATE TABLE user_book_progress (
  id, user_id, book_uuid,
  is_completed,         -- 0=æœªè¯», 1=å·²è¯»
  completed_at,         -- æ ‡è®°æ—¶é—´
  last_read_at,         -- æœ€åé˜…è¯»æ—¶é—´
  UNIQUE(user_id, book_uuid)
)
```

## ğŸ”Œ API

| æ–¹æ³• | ç«¯ç‚¹ | è®¤è¯ | åŠŸèƒ½ |
|------|------|------|------|
| POST | `/api/book/:uuid/mark-complete` | âœ“ | æ ‡è®°å·²è¯»/æœªè¯» |
| GET | `/api/book/:uuid/progress` | å¯é€‰ | è·å–é˜…è¯»çŠ¶æ€ |

### POST è¯·æ±‚ç¤ºä¾‹
```json
{
  "isCompleted": true  // true=å·²è¯», false=æœªè¯»
}
```

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "progress": {
    "id": 1,
    "user_id": 123,
    "book_uuid": "abc-123",
    "is_completed": 1,
    "completed_at": "2026-02-15T04:50:00.000Z",
    "last_read_at": "2026-02-15T04:50:00.000Z"
  }
}
```

## ğŸ¨ UI ç»„ä»¶

| å…ƒç´  | æ ·å¼ç±» | è¯´æ˜ |
|------|--------|------|
| ç»¿è‰²å¾½ç«  | `.book-completed-badge` | å·²è¯»çŠ¶æ€æŒ‡ç¤º |
| æ ‡è®°æŒ‰é’® | `.mark-complete-btn` | ä¸»äº¤äº’æŒ‰é’® |
| å·²å®Œæˆæ ·å¼ | `.mark-complete-btn.completed` | å·²è¯»çŠ¶æ€æŒ‰é’®æ ·å¼ |

## ğŸ’¾ çŠ¶æ€ç®¡ç†

**å‰ç«¯çŠ¶æ€ï¼š**
```typescript
const [bookProgressMap, setBookProgressMap] = useState<Map<string, UserBookProgress>>(new Map());
```

**å…³é”®æµç¨‹ï¼š**
1. `fetchBooks()` åŠ è½½ä¹¦ç±åå¹¶è¡Œè·å–ç”¨æˆ·è¿›åº¦
2. å¡«å…… `bookProgressMap`ï¼Œkey = bookUuid, value = progress
3. ç‚¹å‡»æŒ‰é’® â†’ POST è¯·æ±‚ â†’ æ›´æ–° map â†’ UI é‡æ–°æ¸²æŸ“

## ğŸ”„ çŠ¶æ€è½¬æ¢

```
æœªè¯» (is_completed=0)
  â†“ ç”¨æˆ·ç‚¹å‡»ã€ŒMark as readã€
  â†“ POST /api/book/:uuid/mark-complete {isCompleted: true}
  â†“ æœåŠ¡å™¨ï¼šis_completed=1, completed_at=NOW()
  â†“
å·²è¯» (is_completed=1)
  â†“ ç”¨æˆ·ç‚¹å‡»ã€ŒMark unreadã€
  â†“ POST /api/book/:uuid/mark-complete {isCompleted: false}
  â†“ æœåŠ¡å™¨ï¼šis_completed=0, completed_at=NULL
  â†“
æœªè¯» (is_completed=0)
```

## ğŸ“ å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| `src/worker/db.ts` | æ•°æ®åº“æ“ä½œå‡½æ•° |
| `src/worker/index.ts` | API è·¯ç”± + è¿ç§» |
| `src/components/BookShelf.tsx` | å‰ç«¯ UI + é€»è¾‘ |
| `src/components/BookShelf.css` | æ ·å¼å®šä¹‰ |
| `docs/FEATURE_MARK_READ.md` | è¯¦ç»†è®¾è®¡æ–‡æ¡£ |
| `docs/FEATURE_DEMO.html` | äº¤äº’å¼æ¼”ç¤º |

## âœ¨ æ”¯æŒçš„åœºæ™¯

- âœ… ç”¨æˆ·æ ‡è®°å…¬å…±ä¹¦ç±ä¸ºå·²è¯»
- âœ… ç”¨æˆ·æ ‡è®°è‡ªå·±ä¸Šä¼ çš„ä¹¦ç±ä¸ºå·²è¯»
- âœ… åŒä¸€æœ¬ä¹¦è¢«å¤šä¸ªç”¨æˆ·åˆ†åˆ«æ ‡è®°
- âœ… ç”¨æˆ·å¯éšæ—¶å–æ¶ˆæ ‡è®°
- âœ… åˆ·æ–°é¡µé¢çŠ¶æ€ä¿ç•™
- âœ… åˆ é™¤ä¸Šä¼ çš„ä¹¦ç±ï¼Œè¿›åº¦è®°å½•ç‹¬ç«‹ä¿ç•™

## ğŸš« é™åˆ¶

- âš ï¸ éœ€è¦ç”¨æˆ·ç™»å½•æ‰èƒ½æ ‡è®°
- âš ï¸ æ¯ä¸ªç”¨æˆ·-ä¹¦ç±ç»„åˆåªæœ‰ä¸€æ¡è¿›åº¦è®°å½•
- âš ï¸ æ ‡è®°æ—¶é—´ä»…åœ¨æ ‡è®°ä¸ºå·²è¯»æ—¶è®°å½•ï¼Œå–æ¶ˆæ ‡è®°æ—¶ä¸º NULL

## ğŸ§ª æµ‹è¯• checklist

```
- [ ] ç™»å½• â†’ å¯è§ã€ŒMark as readã€æŒ‰é’®
- [ ] ç‚¹å‡»æŒ‰é’® â†’ æ˜¾ç¤ºç»¿è‰²å¾½ç« ã€Œâœ“ Readã€
- [ ] åˆ·æ–°é¡µé¢ â†’ çŠ¶æ€ä¿ç•™
- [ ] å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾ â†’ çŠ¶æ€ç‹¬ç«‹
- [ ] å–æ¶ˆæ ‡è®° â†’ å¾½ç« æ¶ˆå¤±ï¼ŒæŒ‰é’®æ–‡æœ¬æ¢å¤
- [ ] æœªç™»å½• â†’ æ— æ³•ç‚¹å‡»ï¼ˆæˆ–æ— æŒ‰é’®ï¼‰
```

## ğŸ“ å­¦ä¹ èµ„æº

- **å®Œæ•´æ¼”ç¤º**ï¼šæ‰“å¼€ `docs/FEATURE_DEMO.html` æŸ¥çœ‹ UI å„ç§çŠ¶æ€
- **è¯¦ç»†è®¾è®¡**ï¼šé˜…è¯» `docs/FEATURE_MARK_READ.md`
- **å®ç°ç»†èŠ‚**ï¼šæŸ¥çœ‹ `docs/IMPLEMENTATION_SUMMARY.md`

---

**æœ€åæ›´æ–°ï¼š** 2026-02-15  
**ç‰ˆæœ¬ï¼š** v1.0 (Initial)  
**çŠ¶æ€ï¼š** ä»£ç å®Œæˆï¼Œå¾…æµ‹è¯•
